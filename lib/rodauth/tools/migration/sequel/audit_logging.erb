<%# lib/rodauth/tools/migration/sequel/audit_logging.erb %>

# Used by the audit logging feature
create_table(:<%= table_prefix %>_authentication_audit_logs) do
  primary_key :id, type: :Bignum
  foreign_key :<%= table_prefix %>_id, :<%= pluralize(table_prefix) %>, null: false, type: :Bignum
  DateTime :at, null: false, default: Sequel::CURRENT_TIMESTAMP
  String :message, null: false
  column :metadata, <%= json_type %>
  index [:<%= table_prefix %>_id, :at], name: :audit_<%= table_prefix %>_at_idx
  index :at, name: :audit_at_idx
end
